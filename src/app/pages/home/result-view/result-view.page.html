<ion-header>
    <ion-toolbar color="success">
        <ion-title>{{result.student.name}} getestet von {{result.examiner.name}}</ion-title>
    </ion-toolbar>
</ion-header>
<ion-content class="childScreenBorder">

    <ion-card style="background: #ecf0f1">
        <ion-card-header>
            <ion-card-title>Testungsdaten</ion-card-title>
        </ion-card-header>
        <mat-divider></mat-divider>
        <ion-card-content>
            <mat-form-field style="width: 40%">
                <input [(ngModel)]="result.student.name"
                       matInput
                       placeholder="Name des Kindes"
                />
            </mat-form-field>
            <!-- <mat-form-field style="float: right; width: 40%">
                <input [matDatepicker]="birthdatePicker" [value]="birthdateControl.value"
                       (dateChange)="setNewBirthdate($event)" disabled
                       matInput placeholder="Geburtsdatum">
                <mat-datepicker-toggle [for]="birthdatePicker" matSuffix></mat-datepicker-toggle>
                <mat-datepicker #birthdatePicker disabled="false"></mat-datepicker>
            </mat-form-field>
            <br>

            <mat-form-field style="width: 40%">
                <mat-select [(ngModel)]="result.student.nativeLanguage" placeholder="Muttersprache">
                    <mat-option *ngFor="let language of languages" [value]="language.value">
                        {{language.viewValue}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field style="float: right;width: 40%">
                <mat-select [(ngModel)]="result.student.sex" placeholder="Geschlecht">
                    <mat-option value="m">männlich</mat-option>
                    <mat-option value="w">weiblich</mat-option>
                </mat-select>
            </mat-form-field>
            <br> -->
            <mat-form-field style="float: right;width: 40%">
                <input matInput [(ngModel)]="result.student.school.name" placeholder="Bildungseinrichtung"/>
            </mat-form-field>
            <mat-form-field style="float: right;width: 40%">
                <input matInput [(ngModel)]="result.student.className" placeholder="Klasse"/>
            </mat-form-field>
            <br><br>
            <!-- <mat-radio-group [(ngModel)]="aoAnswer">
                <label style="position: absolute;left: 10%;">a.o. Status:</label>
                <mat-radio-button style="position: absolute;left: 60%;" value="yes">Ja</mat-radio-button>
                <mat-radio-button style="position: absolute; left: 80%;" value="no">Nein
                </mat-radio-button>
            </mat-radio-group>
            <br><br>
            <mat-radio-group [(ngModel)]="spfAnswer">
                <label style="position: absolute;left: 10%;">SPF Status:</label>
                <mat-radio-button style="position: absolute;left: 60%;" (click)="onSpf(true)" value="yes">Ja
                </mat-radio-button>
                <mat-radio-button style="position: absolute;left: 80%;" (click)="onSpf(false)" value="no">Nein
                </mat-radio-button>
            </mat-radio-group>
            <br><br>
            <mat-radio-group [(ngModel)]="currentlyPreschoolAnswer">
                <label style="position: absolute;left: 10%;">Aktuell Vorschule:</label>
                <mat-radio-button style="position: absolute;left: 60%;" value="yes">Ja</mat-radio-button>
                <mat-radio-button style="position: absolute; left: 80%;" value="no">Nein
                </mat-radio-button>
            </mat-radio-group>
            <br><br>
            <mat-radio-group [(ngModel)]="alreadyPreschoolAnswer">
                <label style="position: absolute;left: 10%;">Bereits Vorschule:</label>
                <mat-radio-button style="position: absolute;left: 60%;" value="yes">Ja</mat-radio-button>
                <mat-radio-button style="position: absolute;left: 80%;" value="no">Nein
                </mat-radio-button>
            </mat-radio-group> -->
            <br><br>
            <mat-form-field style="width: 100%" class="input-full-width">
                <input [(ngModel)]="this.result.examiner.name" matInput placeholder="Vor- und Nachname des Untersuchers"
                       required>
            </mat-form-field>

            <!-- <div *ngIf="this.result.results.length != 1">    Familienanamnese bei GRAWO nicht anzeigen 
                <h5 style="margin: 2%;font-weight: bold">Gibt es in Ihrer Familie Personen, welche das Lesen und/ oder
                    Rechtschreiben selbst als mühsam erlebt haben beziehungsweise bei welchen eine Leghasthenie
                    festgestellt wurde?</h5>
                <br>
                <mat-radio-group [(ngModel)]="dyslexia_mother">
                    <label style="position: absolute;left: 10%;">Kindsmutter:</label>
                    <mat-radio-button style="position: absolute;left: 60%;" value="yes">Ja</mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 80%;" value="no">Nein
                    </mat-radio-button>
                </mat-radio-group>
                <br><br>
                <mat-radio-group [(ngModel)]="dyslexia_father">
                    <label style="position: absolute;left: 10%;">Kindsvater:</label>
                    <mat-radio-button style="position: absolute;left: 60%;" value="yes">Ja</mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 80%;" value="no">Nein
                    </mat-radio-button>
                </mat-radio-group>
                <br><br>
                <mat-radio-group [(ngModel)]="dyslexia_sibling">
                    <label style="position: absolute;left: 10%;">mind. ein Geschwisterchen:</label>
                    <mat-radio-button style="position: absolute;left: 60%;" value="yes">Ja</mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 80%;" value="no">Nein
                    </mat-radio-button>
                </mat-radio-group>
                <br><br>
                <mat-radio-group [(ngModel)]="dyslexia_grandParent">
                    <label style="position: absolute;left: 10%;">mind. ein Großelternteil:</label>
                    <mat-radio-button style="position: absolute;left: 60%;" value="yes">Ja</mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 80%;" value="no">Nein
                    </mat-radio-button>
                </mat-radio-group>
                <br><br>
                <mat-radio-group [(ngModel)]="this.dyslexia_otherRelatives">
                    <label style="position: absolute;left: 10%;">weitere Verwandte:</label>
                    <mat-radio-button style="position: absolute;left: 60%;" value="yes">Ja</mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 80%;" value="no">Nein
                    </mat-radio-button>
                </mat-radio-group>
                <br><br>

                <h5 style="margin: 2%;font-weight: bold">Was ist Ihr höchster Bildungsabschluss?</h5>
                <br>

                <h5>erziehungsberechtigte Mutter:</h5>


                <mat-radio-group [(ngModel)]="this.result.student.educationMother">
                    <br>
                    <mat-radio-button style="position: absolute;left: 5%" value="Hauptschule">Hauptschule
                    </mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 45%" value="Lehre">Lehre</mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 85%" value="Matura">Matura</mat-radio-button>
                    <br><br>
                    <mat-radio-button style="position: absolute;left: 5%" value="Studium oder Äquivalent">Studium oder
                        Äquivalent
                    </mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 45%" value="Sonstige">Sonstige</mat-radio-button>
                </mat-radio-group>
                <br><br>
                <h5>erziehungsberechtigte Vater:</h5>


                <mat-radio-group [(ngModel)]="this.result.student.educationFather">
                    <br>
                    <mat-radio-button style="position: absolute;left: 5%" value="Hauptschule">Hauptschule
                    </mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 45%" value="Lehre">Lehre</mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 85%" value="Matura">Matura</mat-radio-button>
                    <br><br>
                    <mat-radio-button style="position: absolute;left: 5%" value="Studium oder Äquivalent">Studium oder
                        Äquivalent
                    </mat-radio-button>
                    <mat-radio-button style="position: absolute;left: 45%" value="Sonstige">Sonstige</mat-radio-button>
                </mat-radio-group>
            </div>
 -->
            <br><br>

        </ion-card-content>
    </ion-card>


    <ion-card style="background: #ecf0f1">
        <ion-card-header>
            <ion-card-title>Allgemeine Notiz</ion-card-title>
        </ion-card-header>
        <mat-divider></mat-divider>
        <ion-card-content>
            <mat-form-field style="width: 100%; height: 100%;">
        <textarea [(ngModel)]="result.student.note"
                  matInput
                  rows="7"
                  style="background: white; width: 100%; height: 100%;"></textarea>
            </mat-form-field>
        </ion-card-content>
    </ion-card>
    <ion-card *ngFor="let exercise of result.results" style="background: #ecf0f1">
        <ion-card-header>
            <ion-card-title>{{exercise.title}}</ion-card-title>
            <ion-card-subtitle>
                <div *ngIf="exercise.finished; else notFinished">
                    <ion-text color="success">Abgeschlossen</ion-text>
                </div>
                <div *ngIf="!result.finished === true && exercise.title === 'Schreiben'">
                    <ion-text color="danger">Noch nicht bewertet</ion-text>
                </div>
                <ng-template #notFinished>
                    <ion-text color="danger">Nicht abgeschlossen</ion-text>
                    <br/>
                    <ion-button (click)="jumpToExercise(exercise)"
                                *ngIf="exercise.number === lastExerciseThatWasntFinished">
                        Testung fortführen
                    </ion-button>
                </ng-template>
            </ion-card-subtitle>
        </ion-card-header>
        <ion-card-content *ngIf="exercise.finished">
            <div *ngIf="exercise.sumCorrect !== undefined">
                <mat-form-field>
                    <input [(ngModel)]="exercise.sumCorrect"
                           matInput
                           placeholder="Summe korrekter Aufgaben"
                           type="number"
                    />
                </mat-form-field>
                <br/>

                <div *ngIf="exercise.gralevAnswers !== undefined">
                    <div *ngFor="let answer of exercise.gralevAnswers" style=" margin-bottom: 7%;">
                        <mat-radio-group [(ngModel)]="answer.correct">
                            <label style="position: absolute; width: 55%;">{{answer.number}}. {{answer.correctWord}}<br>Ausgewählte Antwort: {{answer.word}} </label>
                            <mat-radio-button style="position: absolute;left: 60%;" value="Richtig">Richtig
                            </mat-radio-button>
                            <mat-radio-button style="position: absolute;left: 80%;" value="Falsch">Falsch
                            </mat-radio-button>
                        </mat-radio-group>
                        <br><br>
                    </div>
                </div>

                <div *ngIf="exercise.gradigAnswers !== undefined">
                    <mat-form-field>
                        <input [(ngModel)]="exercise.timeOverall"
                               matInput
                               placeholder="Insgesamt gebrauchte Zeit"
                               type="string"
                        />
                    </mat-form-field>
                    <div *ngFor="let answer of exercise.gradigAnswers" style=" margin-bottom: 7%;">
                        <mat-radio-group [(ngModel)]="answer.correct">
                            <label style="position: absolute; width: 55%;">{{answer.number}}. {{answer.correctWord}}<br>Ausgewählte Antwort: {{answer.word}}<br><span *ngIf="answer.duration!==''">Gebrauchte Zeit: {{answer.duration}}</span></label>
                            <mat-radio-button style="position: absolute;left: 60%;" value="Richtig">Richtig
                            </mat-radio-button>
                            <mat-radio-button style="position: absolute;left: 80%;" value="Falsch">Falsch
                            </mat-radio-button>
                        </mat-radio-group>
                        <br><br>
                    </div>
                </div>

                <div *ngIf="exercise.title === 'Passiver Wortschatz'">
                    <div *ngFor="let answer of exercise.answers">
                        <mat-radio-group [(ngModel)]="answer.correct">
                            <label style="position: absolute;left: 10%;">{{answer.number}}. {{answer.word}}</label>
                            <mat-radio-button style="position: absolute;left: 60%;" value="Richtig">Richtig
                            </mat-radio-button>
                            <mat-radio-button style="position: absolute;left: 80%;" value="Falsch">Falsch
                            </mat-radio-button>
                        </mat-radio-group>
                        <br><br>
                    </div>
                </div>

            </div>
            <div *ngIf="exercise.adultAnswers !== undefined">
                <div *ngFor="let answer of exercise.adultAnswers" style=" padding-bottom: 5%; margin-bottom: 10%;">
                    <mat-radio-group [(ngModel)]="answer.selected">
                        <label style="position: absolute; width: 45%;">{{answer.question}}: </label>
                        <mat-radio-button style="position: absolute;left: 55%;" [value]="answer.answers[0]">{{answer.answers[0]}}
                        </mat-radio-button>
                        <br>
                        <mat-radio-button style="position: absolute;left: 55%;" [value]="answer.answers[1]">{{answer.answers[1]}}
                        </mat-radio-button>
                        <br>
                        <mat-radio-button style="position: absolute;left: 55%;" [value]="answer.answers[2]">{{answer.answers[2]}}
                        </mat-radio-button>
                    </mat-radio-group>
                </div>
            </div>
            <div *ngIf="exercise.answers !== undefined && exercise.title != 'Passiver Wortschatz'">
                <div *ngFor="let answer of exercise.answers" style=" padding-bottom: 7%; margin-bottom: 10%;">
                    <mat-radio-group [(ngModel)]="answer.selected">
                        <label style="position: absolute; width: 50%;">{{answer.question}}: </label>
                        <mat-radio-button style="position: absolute;left: 55%;" value="ja">Ja
                        </mat-radio-button>
                        <mat-radio-button style="position: absolute;left: 65%;" value="manchmal">Manchmal
                        </mat-radio-button>
                        <mat-radio-button style="position: absolute;left: 85%;" value="nein">Nein
                        </mat-radio-button>
                    </mat-radio-group>
                </div>
            </div>
            <div *ngIf="exercise.correct !== undefined">
                    <mat-radio-group [(ngModel)]="exercise.correct">
                        <label style="position: absolute;">Aufgabe Korrekt: </label>
                        <mat-radio-button style="position: absolute;left: 40%;" [checked]="exercise.correct" [value]="true">Richtig
                        </mat-radio-button>
                        <mat-radio-button style="position: absolute;left: 60%;" [checked]="!exercise.correct" [value]="false">Falsch
                        </mat-radio-button>
                    </mat-radio-group>
                <br/>
            </div>
            <div *ngIf="exercise.route === 'lv-schreiben'">
                <ion-button (click)="jumpToEvaluation(result)">
                    Bewerten
                </ion-button>
                <br/>
                <div *ngIf="exercise.corrects !== undefined">
                    <div *ngFor="let c of exercise.corrects; let i = index" style=" padding-bottom: 7%; margin-bottom: 10%;">
                        <mat-radio-group [(ngModel)]="c">
                            <label style="position: absolute;">{{exercise.words[i]}}</label>
                            <mat-radio-button style="position: absolute;left: 40%;" [checked]="c" [value]="true">Richtig
                            </mat-radio-button>
                            <mat-radio-button style="position: absolute;left: 60%;" [checked]="c" [value]="false">Falsch
                            </mat-radio-button>
                        </mat-radio-group>
                    </div>
                <br/>
                </div>
            </div>
            <div *ngIf="exercise.sumFalse !== undefined">
                <mat-form-field>
                    <input [(ngModel)]="exercise.sumFalse"
                           matInput
                           placeholder="Summe falscher Aufgaben"
                           type="number"/>
                    <br/>
                </mat-form-field>
            </div>
            <div *ngIf="exercise.sumRepetitions !== undefined">
                <mat-form-field>
                    <input [(ngModel)]="exercise.sumRepetitions"
                           matInput
                           placeholder="Summe wiederholter Aufgaben"
                           type="number"/>
                </mat-form-field>
                <br/>
            </div>
            <div *ngIf="exercise.longestSpan !== undefined">
                <mat-form-field>
                    <input [(ngModel)]="exercise.longestSpan"
                           matInput
                           placeholder="Längste Spanne"
                           type="number"/>
                </mat-form-field>
                <br/>
            </div>
            <div *ngIf="exercise.sumFalsePictures !== undefined">
                <mat-form-field>
                    <input [(ngModel)]="exercise.sumFalsePictures"
                           matInput
                           placeholder="Bilder | Summe falscher Aufgaben"
                           type="number"/>
                </mat-form-field>
                <br/>
            </div>
            <div *ngIf="exercise.timePictures !== undefined">
                <mat-form-field>
                    <input [(ngModel)]="exercise.timePictures"
                           matInput
                           placeholder="Bilder | Benötigte Zeit"/>
                </mat-form-field>
                <br/>
            </div>
            <div *ngIf="exercise.sumFalseNumbers !== undefined">
                <mat-form-field>
                    <input [(ngModel)]="exercise.sumFalseNumbers"
                           matInput
                           placeholder="Zahlen | Summe falscher Aufgaben"
                           type="number"/>
                </mat-form-field>
                <br/>
            </div>
            <div *ngIf="exercise.timeNumbers !== undefined">
                <mat-form-field>
                    <input [(ngModel)]="exercise.timeNumbers"
                           matInput
                           placeholder="Zahlen | Benötigte Zeit"/>
                </mat-form-field>
                <br/>
            </div>
            <div *ngIf="exercise.sumCorrectA !== undefined">
                <mat-form-field>
                    <input [(ngModel)]="exercise.sumCorrectA"
                           matInput
                           placeholder="Teil A | Summe korrekter Aufgaben"
                           type="number"/>
                </mat-form-field>
                <br/>
            </div>
            <div *ngIf="exercise.sumCorrectB !== undefined">
                <mat-form-field>
                    <input [(ngModel)]="exercise.sumCorrectB"
                           matInput
                           placeholder="Teil B | Summe korrekter Aufgaben"
                           type="number"/>
                </mat-form-field>
                <br/>
            </div>
            <div *ngIf="exercise.dict !== undefined">
                <ion-grid>
                    <div *ngFor="let i of numberArray">
                        <div *ngIf="exercise.dict[i] !== undefined && exercise.dict[i] !== null && exercise.dict[i] !== ''"
                             style="font-size: 1.9vh;">
                            <ion-row>
                                <ion-col size="2">
                                    Nummer <b>{{i + 1}}</b>
                                </ion-col>
                                <ion-col>
                                    <mat-checkbox [(ngModel)]="exercise.dict[i]"></mat-checkbox>
                                </ion-col>
                            </ion-row>
                        </div>
                    </div>
                    <div *ngFor="let i of letterArray">
                        <div *ngIf="exercise.dict[i] !== undefined && exercise.dict[i] !== null && exercise.dict[i] !== ''"
                             style="font-size: 2.5vh">
                            <ion-row>
                                <ion-col size="1"><b>{{i}}</b></ion-col>
                                <ion-col>
                                    <mat-checkbox [(ngModel)]="exercise.dict[i]"></mat-checkbox>
                                </ion-col>
                            </ion-row>
                        </div>
                    </div>
                    <div *ngFor="let i of wordsArray">
                        <div *ngIf="exercise.dict[i] !== undefined && exercise.dict[i] !== null && exercise.dict[i] !== ''">
                            <ion-row>
                                <ion-col size="4">
                                    Wort <b>'{{i.split('.')[0]}}'</b>
                                </ion-col>
                                <ion-col>
                                    <mat-checkbox [(ngModel)]="exercise.dict[i]"></mat-checkbox>
                                </ion-col>
                            </ion-row>
                        </div>
                    </div>
                    <div *ngFor="let i of sentencesArray">
                        <div *ngIf="exercise.dict[i] !== undefined && exercise.dict[i] !== null && exercise.dict[i] !== ''">
                            <ion-row>
                                <ion-col size="8">
                                    Satz <b>'{{i.split('.')[0]}}'</b>
                                </ion-col>
                                <ion-col>
                                    <mat-checkbox [(ngModel)]="exercise.dict[i]"></mat-checkbox>
                                </ion-col>
                            </ion-row>
                        </div>
                    </div>
                </ion-grid>
            </div>
            <ion-text>
                <mat-form-field style="width: 75%; height: 100%;">
          <textarea [(ngModel)]="exercise.note"
                    matInput
                    placeholder="Notiz"
                    rows="7"
                    style="background: white; width: 100%; height: 100%;">
          </textarea>
                </mat-form-field>
            </ion-text>
        </ion-card-content>
    </ion-card>
</ion-content>
<ion-footer>
    <ion-toolbar class="examinerScreenBorder">
        <ion-buttons slot="start">
            <ion-button (click)="onCancel()" color="dark">Abbrechen</ion-button>
        </ion-buttons>
        <ion-buttons slot="start">
            <ion-button (click)="onDelete()" color="danger">Löschen</ion-button>
        </ion-buttons>
        <ion-buttons *ngIf="canUpload()===true" slot="end">
            <ion-button *ngIf="isSended()===false" (click)="this.dataService.sendResult(this.result)" [disabled]="dataService.blockUiButtons"  class="btn" color="success">Testung hochladen</ion-button>
            <ion-button *ngIf="isSended()===true" (click)="onSend()" [disabled]="dataService.blockUiButtons"  class="btn" color="success">Testung erneut hochladen</ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
            <ion-button (click)="onSave()" color="success">Speichern</ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-footer>
